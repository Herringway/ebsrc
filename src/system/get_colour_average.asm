
;void near GetColorAverage(uint NEAR* ptr)
GET_COLOUR_AVERAGE: ;$C00391
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8 | PROC_FLAGS::CARRY
	RESERVE_STACK_SPACE 26
	STA $18
	STZ $16
	STZ $14
	LDA #$0000
	STA $04
	TAY
	STY $12
	LDA $18
	DEC
	DEC
	STA $02
	STA $10
	LDX #$0000
	STX $0E
	BRA @UNKNOWN2
@UNKNOWN0:
	LDA $10
	STA $02
	INC $02
	INC $02
	LDA $02
	STA $10
	LDX $02
	LDA RAM,X
	STA $18
	AND #$7FFF
	BEQ @UNKNOWN1
	LDA $18
	AND #BGR555::RED
	STA $02
	LDA $04
	CLC
	ADC $02
	STA $04
	LDA $18
	AND #BGR555::GREEN
	LSR
	LSR
	LSR
	LSR
	LSR
	CLC
	ADC $14
	STA $14
	LDA $18
	AND #BGR555::BLUE
	XBA
	AND #$00FF
	LSR
	LSR
	CLC
	ADC $16
	STA $16
	INY
	STY $12
@UNKNOWN1:
	LDX $0E
	INX
	STX $0E
@UNKNOWN2:
	CPX #$0060
	BCC @UNKNOWN0
	LDA $04
	ASL
	ASL
	ASL
	JSL DIVISION16S_DIVISOR_POSITIVE
	STA UNKNOWN_7E43D0
	LDY $12
	LDA $14
	ASL
	ASL
	ASL
	JSL DIVISION16S_DIVISOR_POSITIVE
	STA UNKNOWN_7E43D2
	LDY $12
	LDA $16
	ASL
	ASL
	ASL
	JSL DIVISION16S_DIVISOR_POSITIVE
	STA UNKNOWN_7E43D4
	PLD
	RTS
