
;void UpdateParty(void)
UPDATE_PARTY: ;$C034D6
	@LOCAL1 = $0E ;short[6]
	@LOCAL2 = $1A ;short[6]
	@LOCAL3 = $26 ;short[6]
	@LOCAL4 = $32 ;short[6]
	@LOCAL5 = $46 ;short
	@LOCAL7 = $46 ;short
	@LOCAL8 = $04 ;short
	@LOCAL9 = $40 ;short
	@LOCAL10 = $44 ;short
	@LOCAL11 = $46 ;short
	@PARTY_COUNT = $48 ;short
	@LOCAL13 = $42 ;short
	@LOCAL14 = $3E ;short
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8 | PROC_FLAGS::CARRY
	RESERVE_STACK_SPACE_CLOBBER 74
	LDA .LOWORD(GAME_STATE)+game_state::party_count
	AND #$00FF
	STA @PARTY_COUNT
	LDA #$0000
	STA @LOCAL11
	BRA @UNKNOWN1
@UNKNOWN0:
	ASL
	PHA
	LDA @LOCAL11
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAX
	LDA a:game_state::player_controlled_party_members,X
	AND #$00FF
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	LDA .LOWORD(CHAR_STRUCT)+char_struct::position_index,X
	PLX
	STA @LOCAL1,X
	LDA @LOCAL11
	INC
	STA @LOCAL11
@UNKNOWN1:
	CMP @PARTY_COUNT
	BCC @UNKNOWN0
	LDX #$0000
	STX @LOCAL10
	JMP @UNKNOWN6
@UNKNOWN2:
	TXA
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAX
	LDA a:game_state::unknown96,X
	AND #$00FF
	STA @LOCAL13
	CMP #$0005
	BCC @UNKNOWN3
	CLC
	ADC #$0300
	STA @LOCAL13
	BRA @UNKNOWN5
@UNKNOWN3:
	LDX @LOCAL10
	TXA
	ASL
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAX
	LDA a:game_state::unknownA2,X
	ASL
	TAX
	LDA .LOWORD(ENTITY_SCRIPT_VAR1_TABLE),X
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	LDA .LOWORD(CHAR_STRUCT)+char_struct::afflictions,X
	AND #$00FF
	TAY
	CPY #$0001
	BEQ @UNKNOWN4
	CPY #$0002
	BNE @UNKNOWN5
@UNKNOWN4:
	LDA @LOCAL13
	CLC
	ADC #$0100
	STA @LOCAL13
@UNKNOWN5:
	LDX @LOCAL10
	TXA
	ASL
	TAY
	LDA @LOCAL13
	TYX
	STA @LOCAL2,X
	TYA
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAX
	LDA a:game_state::unknownA2,X
	TAX
	STX @LOCAL3,Y
	LDX @LOCAL10
	TXA
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAX
	LDA a:game_state::player_controlled_party_members,X
	AND #$00FF
	TAX
	STX @LOCAL4,Y
	LDX @LOCAL10
	INX
	STX @LOCAL10
@UNKNOWN6:
	CPX @PARTY_COUNT
	BCCL @UNKNOWN2
	STZ_BADOPT @LOCAL8
	JMP @UNKNOWN12
@UNKNOWN8:
	LDX #$0000
	STX @LOCAL7
	BRA @UNKNOWN11
@UNKNOWN9:
	TXA
	ASL
	TAY
	TYX
	LDA @LOCAL2,X
	STA @LOCAL9
	STY $02
	INC $02
	INC $02
	LDX $02
	LDA @LOCAL2,X
	STA @LOCAL14
	LDA @LOCAL9
	CMP @LOCAL14
	BLTEQ @UNKNOWN10
	LDX @LOCAL7
	TXA
	ASL
	TAX
	LDA @LOCAL14
	STA @LOCAL2,X
	LDX @LOCAL7
	TXA
	ASL
	TAX
	INX
	INX
	LDA @LOCAL9
	STA @LOCAL2,X
	TYX
	LDA @LOCAL3,X
	STA @LOCAL9
	LDX @LOCAL7
	TXA
	ASL
	PHA
	LDX $02
	LDA @LOCAL3,X
	PLX
	STA @LOCAL3,X
	LDX @LOCAL7
	TXA
	ASL
	TAX
	INX
	INX
	LDA @LOCAL9
	STA @LOCAL3,X
	LDX @LOCAL4,Y
	TXY
	LDX @LOCAL7
	TXA
	ASL
	PHA
	LDX $02
	LDA @LOCAL4,X
	PLX
	STA @LOCAL4,X
	LDX @LOCAL7
	TXA
	ASL
	TAX
	INX
	INX
	STY @LOCAL4,X
@UNKNOWN10:
	LDX @LOCAL7
	INX
	STX @LOCAL7
@UNKNOWN11:
	LDA @PARTY_COUNT
	DEC
	STA $02
	TXA
	CMP $02
	BCC @UNKNOWN9
	INC @LOCAL8
@UNKNOWN12:
	LDA @PARTY_COUNT
	DEC
	STA $02
	LDA @LOCAL8
	CMP $02
	BCCL @UNKNOWN8
	LDA #$0000
	STA @LOCAL13
	BRA @UNKNOWN15
@UNKNOWN14:
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAY
	LDA @LOCAL13
	ASL
	STA $02
	LDX $02
	SEP #PROC_FLAGS::ACCUM8
	LDA @LOCAL2,X
	STA a:game_state::unknown96,Y
	REP #PROC_FLAGS::ACCUM8
	LDA $02
	CLC
	ADC #.LOWORD(GAME_STATE)
	CLC
	ADC #game_state::unknownA2
	TAX
	STX @LOCAL5
	LDX $02
	LDA @LOCAL3,X
	LDX @LOCAL5
	STA a:.LOWORD(RAM),X
	LDX $02
	SEP #PROC_FLAGS::ACCUM8
	LDA @LOCAL4,X
	STA a:game_state::player_controlled_party_members,Y
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL13
	ASL
	TAX
	LDA @LOCAL4,X
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	PHA
	LDX $02
	LDA @LOCAL1,X
	PLX
	STA .LOWORD(CHAR_STRUCT)+char_struct::position_index,X
	LDX @LOCAL5
	LDA a:.LOWORD(RAM),X
	ASL
	TAX
	LDA $02
	STA .LOWORD(ENTITY_SCRIPT_VAR5_TABLE),X
	LDA @LOCAL13
	INC
	STA @LOCAL13
@UNKNOWN15:
	CMP @PARTY_COUNT
	BCC @UNKNOWN14
	LDA .LOWORD(GAME_STATE) +game_state::unknownA2
	STA .LOWORD(GAME_STATE)+game_state::current_party_members
	JSL UNKNOWN_C032EC
	JSL UNKNOWN_C02C3E
	JSL UNKNOWN_C47F87
	PLD
@UNKNOWN16:
	RTL
